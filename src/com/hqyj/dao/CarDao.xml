<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hqyj.dao.CarDao">

    <!-- 查询车辆列表，支持按车牌模糊查询 -->
    <select id="getList" parameterType="car" resultType="car">
        select * from car
        <where>
            <if test="cno != null and cno != ''">
                and cno like '%${cno}%'
            </if>
        </where>
    </select>

    <!-- 添加车辆 -->
    <insert id="add" parameterType="car">
        insert into car(cno, name, dno, backup, createtime)
        values(#{cno}, #{name}, #{dno}, #{backup}, now())
    </insert>
    
    <delete id="delete" parameterType="string">
        DELETE FROM car WHERE cno = #{cno}
    </delete>

	<select id="getCar" parameterType="string" resultType="car">
        select * from car where cno = #{cno}
    </select>

    <update id="update" parameterType="car">
        update car set name=#{name}, dno=#{dno}, backup=#{backup} 
        where cno=#{cno}
    </update>
    
    <select id="getAvailableCarList" resultType="car">
    SELECT * FROM car 
    WHERE cno NOT IN (
        SELECT cno FROM feerecord WHERE state = 1
    )
	</select>
	
</mapper>
